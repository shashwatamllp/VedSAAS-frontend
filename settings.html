<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <meta name="ved-api-base" content="/api">
  <title>VedSAAS • Settings</title>
  <link rel="icon" href="favicon.ico"/>
  <link rel="stylesheet" href="/public/css/theme.css"/>
  <style>
    :root{
      --bg:#1e1e2f; --card:#2c2c3e; --ip:#3a3a4d; --ip-focus:#4a4a5f;
      --text:#fff; --muted:#b9bed1; --brand:#0078d4; --brand-2:#005ea2;
      --ok:#b7ffb7; --err:#ffd7d7;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif;
      background:var(--bg); color:var(--text);
      display:flex; align-items:center; justify-content:center;
      min-height:100vh; overflow:hidden;
    }
    .bg{position:fixed; inset:0; background:url('images/logopic.png') center/520px no-repeat; opacity:.06; pointer-events:none}
    .card{
      position:relative; z-index:1;
      width:min(980px,96vw); max-height:92vh; overflow:auto; scrollbar-gutter:stable;
      background:var(--card); border-radius:14px; padding:18px 18px 16px;
      box-shadow:0 10px 38px rgba(0,0,0,.45);
    }
    h1{font-size:24px; text-align:center; margin-bottom:4px}
    .sub{color:var(--muted); text-align:center; font-size:14px; margin-bottom:12px}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:12px 16px}
    .section{background:#2a2a3a; border-radius:10px; padding:12px}
    .section h3{font-size:15px; margin-bottom:8px}
    .row{display:flex; align-items:center; justify-content:space-between; gap:10px; padding:8px 0; border-top:1px solid rgba(255,255,255,.06)}
    .row:first-child{border-top:none}
    .btn{padding:10px 12px; border:none; border-radius:10px; background:var(--brand); color:#fff; cursor:pointer; font-weight:600}
    .btn:hover{background:var(--brand-2)}
    .btn.secondary{background:#444}
    .btn.danger{background:#a22}
    .btn.danger:hover{background:#821b1b}
    .pill{padding:6px 10px; border-radius:999px; background:#3a3a4d; font-size:12px; color:#dfe3f4}
    .avatar{width:48px;height:48px;border-radius:50%;background:#555 center/cover no-repeat; display:inline-block; margin-right:10px}
    .userline{display:flex; align-items:center}
    .muted{color:#b9bed1}
    .msg{min-height:18px; text-align:center; font-size:13px; margin-top:8px}
    .ok{color:var(--ok)} .err{color:var(--err)}
    .footer{margin-top:10px; text-align:center; color:#9aa0b6; font-size:12px}
    @media (max-width:760px){ .grid{grid-template-columns: 1fr} }
  </style>
</head>
<body>
  <div class="bg"></div>

  <div class="card">
    <h1>Settings & Tools</h1>
    <p class="sub">Manage appearance, language, chats, and account.</p>

    <div class="grid">
      <div class="section">
        <h3>User</h3>
        <div id="user-section" data-user-section></div>
      </div>

      <div class="section">
        <h3>Preferences</h3>
        <div class="row">
          <div>Theme</div>
          <button id="theme-toggle-settings" data-theme-toggle class="btn secondary">Toggle Theme</button>
        </div>
        <div class="row">
          <div>Language</div>
          <div>
            <span class="pill" id="lang-pill" data-lang-display>AUTO</span>
            <button id="lang-toggle" class="btn secondary" style="margin-left:8px">Change</button>
          </div>
        </div>
      </div>

      <div class="section">
        <h3>Chats</h3>
        <div class="row">
          <div>Current chat</div>
          <div class="muted" id="cur-title">—</div>
        </div>
        <div class="row">
          <div>Export chats (JSON)</div>
          <button id="export" class="btn secondary">Export</button>
        </div>
        <div class="row">
          <div>Delete current chat</div>
          <button id="delete-current" class="btn danger">Delete</button>
        </div>
        <div class="row">
          <div>Clear ALL chats</div>
          <button id="clear-all" class="btn danger">Clear All</button>
        </div>
      </div>

      <div class="section">
        <h3>About</h3>
        <div class="row">
          <div class="muted">VedSAAS • Shashwatam Eco-Chie Creations LLP</div>
          <span class="pill" id="stat-local">Local: 0 KB</span>
        </div>
      </div>
    </div>

    <div id="msg" class="msg"></div>
    <div class="footer">© VedSAAS by Shashwatam Eco-Chie Creations LLP</div>
  </div>

<script>
  const $=id=>document.getElementById(id);
  const msg=(t,ok=false)=>{ const m=$('msg'); m.className='msg '+(ok?'ok':'err'); m.textContent=t||''; };
  function bytes(obj){ try{ return JSON.stringify(obj).length; }catch{ return 0; } }
  function sizeKB(n){ return Math.round((n||0)/1024); }

  let topics=[]; let current=null;
  try{ topics = JSON.parse(localStorage.getItem('ved_topics')||'[]'); }catch{}
  try{ current = localStorage.getItem('ved_current') || (topics[0]&&topics[0].id) || null; }catch{}
  const curTopic = topics.find(t=>t.id===current);
  $('cur-title').textContent = curTopic ? (curTopic.title || 'Chat') : '—';
  $('stat-local').textContent = 'Local: '+sizeKB(bytes(topics))+' KB';

  // Language toggle functionality  
  const order=['auto','en','hi','es'];
  $('lang-toggle').onclick=()=>{
    const currentLang = window.VedLang ? window.VedLang.current() : 'auto';
    const nextIdx = (order.indexOf(currentLang) + 1) % order.length;
    const nextLang = order[nextIdx];
    if (window.VedLang) {
      window.VedLang.save(nextLang);
      window.VedLang.updateDisplay('#lang-pill');
    }
    msg('Language: '+nextLang.toUpperCase(), true);
  };

  $('export').onclick=()=>{
    const blob = new Blob([JSON.stringify(topics||[], null, 2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'vedsaas_chats.json';
    a.click();
    URL.revokeObjectURL(a.href);
    msg('Exported chats.', true);
  };

  $('delete-current').onclick=()=>{
    if(!current){ return msg('No current chat.'); }
    if(!confirm('Delete the current chat?')) return;
    const rest = (topics||[]).filter(t=>t.id!==current);
    localStorage.setItem('ved_topics', JSON.stringify(rest));
    const next = (rest[0]&&rest[0].id) || '';
    localStorage.setItem('ved_current', next);
    msg('Current chat deleted.', true);
    setTimeout(()=>location.reload(), 400);
  };

  $('clear-all').onclick=()=>{
    if(!(topics&&topics.length)) return msg('No chats to clear.');
    if(!confirm('This will remove ALL local chats. Continue?')) return;
    localStorage.removeItem('ved_topics');
    localStorage.removeItem('ved_current');
    msg('All chats cleared.', true);
    setTimeout(()=>location.reload(), 300);
  };
</script>

<script src="/public/js/theme-toggle.js"></script>
<script src="/public/js/lang-toggle.js"></script>
<script src="/public/js/settings.js"></script>
</body>
</html>
