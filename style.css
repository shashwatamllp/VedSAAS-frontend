*{margin:0;padding:0;box-sizing:border-box}

/* Base */
html,body{height:100%;font-family:'Segoe UI',sans-serif;background:#1e1e2f;color:#fff;overflow:hidden}
body{min-height:100svh}
body.dark-mode{background:#0e0e12}
input,textarea,select,button{font-size:16px}

/* Shell */
.container{display:flex;height:100vh;position:relative;z-index:1;overflow:hidden}
.sidebar{width:20%;min-width:275px;background:#232336;padding:18px;display:flex;flex-direction:column;gap:12px;overflow:auto}
.sidebar .title{text-align:center;font-weight:700;font-size:15px;color:#eee}
.new-topic-btn{background:#0078d4;color:#fff;border:none;padding:10px;border-radius:8px;cursor:pointer;width:100%}
.new-topic-btn:hover{filter:brightness(1.07)}
.history-list{flex:1;overflow:auto;margin-top:10px;border-top:1px solid #333;padding-top:10px}
.topic{padding:8px 10px;margin-bottom:8px;border-radius:8px;cursor:pointer;color:#ddd}
.topic.active{background:#2e7bbd;color:#fff}
.topic .preview{color:#bbb;font-size:13px;margin-top:4px}
.settings-summary{margin-top:8px}

/* Header user chip -> green */
.user-chip{display:flex;align-items:center;gap:10px;background:#16a34a;border:0;color:#041;padding:6px 10px;border-radius:999px;cursor:pointer;font-weight:600}
.user-chip:hover{filter:brightness(1.05)}
.user-avatar{width:26px;height:26px;border-radius:50%;background:#0078d4;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;overflow:hidden}
.user-name{font-size:13px;color:#0b1;flex:1}
.settings-caret{color:#0b1}
.settings-panel{display:none;margin-top:8px}
.settings-panel .btn-like,.settings-panel button{display:block;width:100%;text-align:left;background:none;border:1px solid #3a3a4d;border-radius:8px;color:#ddd;padding:10px 12px;cursor:pointer;margin-bottom:6px}
.settings-panel button:hover,.settings-panel .btn-like:hover{background:#2f2f42;color:#fff}

/* Main rail + content */
.main{flex:1;display:flex;flex-direction:column;min-width:0;min-height:0;overflow:hidden}
.rail{position:relative;width:100%;max-width:none;margin:0;padding-inline:16px;height:100%;display:flex;flex-direction:column;min-width:0;min-height:0}

/* Logo background on landing */
#landing::before{
  content:"";
  position:absolute; inset:0;
  background:url("/public/image/logopic.png") center/60% no-repeat;
  opacity:.20; pointer-events:none; z-index:0;
}

/* Topbar hard-center title */
.topbar{padding:14px 18px;border-bottom:1px solid #333;display:flex;align-items:center;justify-content:center;background:transparent;position:relative;z-index:1}
.topbar h1{margin:0;font-size:20px;letter-spacing:1px}
.top-controls{position:absolute;right:0;top:50%;transform:translateY(-50%);display:flex;gap:8px;align-items:center}
.topbar .meta{color:#bbb;font-size:14px}
.topbar .menu-btn{display:none;align-items:center;gap:8px;padding:8px 10px;border:1px solid #333;border-radius:8px;background:#1a1a1a;color:#fff}

/* Hide API badge and Local KB text */
#api-ok-badge,#meta-info{display:none !important}

/* Only chat-area scrolls */
.content{flex:1;min-height:0;display:flex;flex-direction:column;z-index:1;overflow:hidden}

/* Chat list edge-to-edge */
.chat-area{
  flex:1;min-height:0;overflow:auto;
  padding:20px;display:flex;flex-direction:column;gap:12px;
  -webkit-overflow-scrolling:touch;align-items:stretch;
  max-width:none;margin:0;
}

/* Message rows with labels */
.message-row{max-width:80%;position:relative;line-height:1.5;display:flex;flex-direction:column}
.from-user{align-self:flex-end;text-align:right}
.from-bot{align-self:flex-start;text-align:left}
.msg-label{font-size:12px;color:#bbb;margin:2px 4px 6px}
.from-user .msg-label{color:#a8ffd0}
.from-bot  .msg-label{color:#b7c1d6}

/* Bubbles */
.message-row .msg-body{white-space:pre-wrap;word-break:break-word;overflow-wrap:anywhere;border-radius:12px;padding:10px 12px}
.from-bot  .msg-body{background:#2a2a3f;border:1px solid #3b3b53;color:#eaeaf2}
.from-user .msg-body{background:#3a3a52;border:1px solid #4a4a60;color:#ffffff}

/* Hover actions */
.msg-actions{position:absolute;right:-2px;bottom:-18px;display:flex;gap:6px;opacity:0;transition:opacity .15s}
.message-row:hover .msg-actions{opacity:1}
.msg-actions button{background:rgba(0,0,0,.25);border:1px solid #4a4a60;border-radius:6px;color:#fff;font-size:12px;padding:2px 6px;cursor:pointer}
.msg-actions button:hover{background:rgba(255,255,255,.12)}

/* Composer */
.composer-wrap{position:sticky;bottom:0;z-index:2;border-top:1px solid #3a3a4d;background:rgba(30,30,47,.35);backdrop-filter:saturate(180%) blur(8px);padding:12px 16px;display:flex;justify-content:center}
.composer{width:100%;display:flex;align-items:flex-end;gap:10px;background:transparent;border:none;border-radius:0;padding:0}
.composer textarea{flex:1;background:transparent;color:#fff;border:none;outline:none;font-size:15px;line-height:1.4;resize:none;max-height:10rem;min-height:44px;overflow:auto}
.composer .send-btn{width:42px;height:42px;flex:0 0 42px;display:flex;align-items:center;justify-content:center;border-radius:10px;border:1px solid #4a4a60;background:#2f2f42;color:#fff;cursor:pointer}
.composer .send-btn[disabled]{opacity:.5;cursor:not-allowed}
.composer .send-btn:hover:not([disabled]){background:#3b3b53}

/* Landing */
.landing{flex:1;display:flex;align-items:center;justify-content:center;position:relative}
.landing-card{background:rgba(44,44,62,0.92);border:1px solid #333;border-radius:12px;padding:22px;width:min(720px,90vw);text-align:center;position:relative;z-index:1}
.landing .title{font-size:18px;margin-bottom:6px;color:#e9e9e9}
.landing .hint{font-size:13px;color:#bdbdbd;margin-bottom:12px}
.landing .composer{margin-top:10px}
.landing-actions{display:flex;gap:10px;justify-content:center;margin-top:12px}
.btn{background:#444;border:none;color:#fff;padding:10px 12px;border-radius:8px;cursor:pointer}
.btn:hover{background:#555}

/* Auth */
.overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;z-index:50;background:rgba(0,0,0,0.5)}
.auth-box{background:#2c2c3e;padding:28px;border-radius:12px;width:360px;box-shadow:0 6px 30px rgba(0,0,0,0.6);max-height:90vh;overflow:auto;border:1px solid #3a3a4d}
.auth-box h2{color:#fff;margin-bottom:12px;text-align:center}
.auth-box input{width:100%;padding:12px;border-radius:10px;border:1px solid #3f3f55;margin:8px 0;background:#3a3a4d;color:#fff}
.auth-box button{width:100%;padding:12px;border-radius:10px;border:none;background:#0078d4;color:#fff;cursor:pointer;margin-top:8px}
.auth-box small{display:block;color:#aaa;text-align:center;margin-top:6px}

/* Banners */
.banner{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);background:#9b1c1c;color:#fff;padding:10px 14px;border-radius:8px;display:none;z-index:99}
.banner.ok{background:#166534}
.banner.warn{background:#9b1c1c}

/* Typing */
.typing-cursor{display:inline-block;width:1px;background:#fff;margin-left:2px;animation:blink 1s step-end infinite}
@keyframes blink{50%{opacity:0}}
.typing-row{align-self:flex-start;color:#fff}
.dots{display:inline-block}
.dots i{display:inline-block;width:6px;height:6px;border-radius:50%;background:#ddd;margin:0 2px;opacity:.3;animation:bounce 1.2s infinite}
.dots i:nth-child(2){animation-delay:.2s}.dots i:nth-child(3){animation-delay:.4s}
@keyframes bounce{0%,80%,100%{transform:translateY(0);opacity:.3}40%{transform:translateY(-4px);opacity:1}}

/* Scroll-to-bottom */
.to-bottom{position:fixed;right:20px;bottom:84px;background:#2f2f42;border:1px solid #4a4a60;color:#fff;padding:8px 10px;border-radius:999px;display:none;align-items:center;gap:6px;cursor:pointer}
.to-bottom.show{display:flex}

/* Hide scrollbars visually */
body,.chat-area,.history-list{scrollbar-width:none}
body::-webkit-scrollbar,.chat-area::-webkit-scrollbar,.history-list::-webkit-scrollbar{width:0;height:0}

/* Mobile slide-in sidebar + backdrop */
.backdrop{display:none}
@media (max-width:900px){
  .topbar .menu-btn{display:inline-flex}
  .sidebar{
    display:block;
    position:fixed; inset:0 auto 0 0;
    width:min(85vw,320px); max-width:90vw;
    transform:translateX(-100%); transition:transform .25s ease;
    z-index:50; background:#232336; box-shadow:2px 0 24px rgba(0,0,0,.45);
  }
  body.sidebar-open .sidebar{ transform:translateX(0) }
  body.sidebar-open .backdrop{
    display:block; position:fixed; inset:0; background:rgba(0,0,0,.4); z-index:40;
  }
  .container{flex-direction:column;height:auto;min-height:100svh}
  .main,.rail{width:100%}
  .composer textarea{max-height:35vh}
}
@media (max-width:400px){
  h1{font-size:1.15rem}
  .topbar .menu-btn{padding:6px 8px}
}
