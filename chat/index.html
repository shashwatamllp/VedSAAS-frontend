<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>VedSAAS</title>
  <link rel="icon" href="/favicon.ico"/>

  <!-- Same-origin only -->
  <meta http-equiv="Content-Security-Policy" content="
    default-src 'self';
    img-src 'self' data:;
    style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
    script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
    font-src 'self' https://cdnjs.cloudflare.com;
    connect-src 'self';
  ">

  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        referrerpolicy="no-referrer"/>

  <style>
    body{margin:0;background:#1e1e2f;color:#fff;font-family:system-ui}
    .wrap{max-width:900px;margin:auto;padding:16px}
    h1{margin:0 0 8px}
    #status{font-size:12px;opacity:.8;margin-bottom:10px}
    #chat{border:1px solid #333;border-radius:10px;padding:12px;min-height:300px}
    .msg{margin:8px 0}
    .user{text-align:right}
    .bot{text-align:left;opacity:.9}
    textarea{width:100%;margin-top:10px;padding:10px;border-radius:8px;border:none}
    button{margin-top:8px;padding:10px 14px;border-radius:8px;border:none;background:#19c37d;color:#fff}
  </style>
</head>

<body>
<div class="wrap">
  <h1>VedSAAS</h1>
  <div id="status">Checking server…</div>
  <div id="chat"></div>
  <textarea id="input" rows="2" placeholder="Message VedSAAS…"></textarea>
  <button id="send">Send</button>
</div>

<script>
/* ===== API (FINAL) ===== */
const API_BASE = '';
function api(path){
  let p=String(path||'');
  if(!p.startsWith('/')) p='/'+p;
  return '/api'+p;
}

/* ===== UI ===== */
const chat=document.getElementById('chat');
const input=document.getElementById('input');
const status=document.getElementById('status');

function add(role,text){
  const d=document.createElement('div');
  d.className='msg '+role;
  d.textContent=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
}

/* ===== Health ===== */
async function ping(){
  try{
    const r=await fetch(api('/health'));
    status.textContent=r.ok?'Online':'Offline';
  }catch{
    status.textContent='Offline';
  }
}
ping();
setInterval(ping,5000);

/* ===== Send ===== */
async function send(){
  const text=input.value.trim();
  if(!text) return;
  input.value='';
  add('user',text);
  try{
    const r=await fetch(api('/chat'),{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({message:text})
    });
    if(!r.ok) throw new Error('HTTP '+r.status);
    const j=await r.json();
    add('bot',j.response||j.answer||'No reply');
  }catch(e){
    add('bot','Connection error: '+e.message);
  }
}
document.getElementById('send').onclick=send;
input.addEventListener('keydown',e=>{
  if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();send();}
});
</script>
</body>
</html>
