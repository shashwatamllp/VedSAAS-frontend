<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta http-equiv="x-content-type-options" content="nosniff" />
  <meta name="referrer" content="strict-origin-when-cross-origin" />

  <!-- API base ko yahin control karo -->
  <meta name="ved-api-base" content="https://api.vedsaas.com" />

  <title>VedSAAS</title>

  <link rel="icon" href="./favicon.ico" />
  <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        referrerpolicy="strict-origin-when-cross-origin" />
  <link rel="stylesheet" href="./style.css" />

  <style>
    :root{ color-scheme:dark }
    body{ margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,sans-serif; background:#0e0f14; color:#e9edf4 }
    .container{ display:none; min-height:100dvh }
    .banner{ padding:8px 12px; text-align:center; font-size:13px; display:none }
    .banner.ok{ display:block; background:#063; color:#c7ffd9; border-bottom:1px solid #055 }
    .banner.warn{ display:block; background:#5a4600; color:#ffe9a8; border-bottom:1px solid #3d2f00 }
    .banner.err{ display:block; background:#5a0000; color:#ffd7d7; border-bottom:1px solid #3d0000 }
    #settings-panel, #settings-panel *{ display:none!important; height:0!important; margin:0!important; padding:0!important; overflow:hidden!important }
    .msg{ padding:10px 12px; margin:10px; border-radius:12px; max-width:900px; line-height:1.45 }
    .msg-user{ background:#1f2a44 }
    .msg-assistant{ background:#1f3a2a }
    .msg-system{ background:#3a1f1f }
    .chat-area{ padding:12px; height:60vh; overflow:auto; border-top:1px solid #233 }
    .composer{ display:flex; gap:8px; padding:12px }
    .composer textarea{ flex:1; resize:none; min-height:38px; max-height:160px; border-radius:10px; padding:10px; border:1px solid #2a3 }
    .send-btn{ border:0; padding:0 14px; border-radius:10px; cursor:pointer }
    .topbar{ display:flex; align-items:center; gap:12px; padding:10px 12px; border-bottom:1px solid #233 }
    .sidebar{ width:240px; border-right:1px solid #233; padding:10px; display:none }
    .rail{ display:flex; min-height:100dvh }
    @media (min-width: 960px){ .sidebar{ display:block } }
  </style>
</head>
<body>
  <div id="backdrop" class="backdrop" aria-hidden="true"></div>

  <noscript>
    <div style="background:#b91c1c;color:#fff;padding:10px;text-align:center">
      JavaScript required. Please enable JS.
    </div>
  </noscript>

  <div id="banner" class="banner" role="status" aria-live="polite"></div>

  <div id="app" class="container">
    <aside class="sidebar" aria-label="Conversation history">
      <div class="title">Chat History</div>
      <button class="new-topic-btn" id="new-topic">+ New Chat</button>
      <div class="history-list" id="history-list"></div>
      <div class="settings-summary" style="margin-top:auto">
        <a id="settings-header" class="user-chip" title="Account & Settings" href="settings.html"
           style="display:flex;align-items:center;gap:8px;text-decoration:none;color:inherit">
          <div id="settings-avatar" class="user-avatar" aria-hidden="true">U</div>
          <div id="settings-username" class="user-name">User</div>
          <i class="fas fa-gear settings-caret" aria-hidden="true"></i>
        </a>
        <div id="settings-panel" class="settings-panel" aria-hidden="true"></div>
      </div>
    </aside>

    <main class="main" style="flex:1">
      <div class="rail">
        <section style="flex:1; display:flex; flex-direction:column; min-height:100dvh">
          <header class="topbar">
            <button id="menu-toggle" class="menu-btn" aria-label="Open menu"><i class="fas fa-bars"></i></button>
            <h1 style="margin:0">VedSAAS <small id="api-ok-badge" style="display:none;margin-left:8px;font-weight:600;color:#6dffb8">API OK</small></h1>
            <div style="margin-left:auto" id="meta-info">Local: 0 KB</div>
          </header>

          <!-- Landing -->
          <section id="landing" style="display:flex; flex-direction:column; gap:12px; padding:16px">
            <div class="title">Start a new conversation</div>
            <div class="hint">Ask anything. Iâ€™ll reply in your language.</div>
            <div class="composer">
              <textarea id="landing-input" placeholder="Type your first message..." rows="1"></textarea>
              <button id="landing-start" class="send-btn" title="Send" aria-label="Send">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
            <div style="display:flex; gap:8px">
              <a class="btn" href="./login.html">Login</a>
              <a class="btn" href="./register.html">Register</a>
              <a class="btn" href="./settings.html">Settings</a>
              <button id="landing-open-history" class="btn">Open Previous Chats</button>
            </div>
          </section>

          <!-- Chat -->
          <section id="chat-shell" style="display:none; flex:1; min-height:0; flex-direction:column;">
            <div class="chat-area" id="chat-area"></div>
            <div class="composer">
              <textarea id="main-input" placeholder="Type your message..." rows="1"></textarea>
              <button id="send-btn" class="send-btn" title="Send" aria-label="Send" disabled>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </section>
        </section>
      </div>
    </main>
  </div>

  <button id="to-bottom" class="to-bottom" style="position:fixed; right:16px; bottom:16px"><i class="fas fa-angle-down"></i> Latest</button>

  <!-- API base bootstrap (same rules as earlier) -->
  <script>
    (function () {
      if (window.API_BASE) return;
      const metaBase = document.querySelector('meta[name="ved-api-base"]')?.content || '';
      const h = (location.hostname || '').toLowerCase();
      const origin = location.origin || '';
      if (metaBase) window.API_BASE = metaBase.replace(/\/$/, '');
      else if (h.endsWith('vedsaas.com')) window.API_BASE = (h === 'api.vedsaas.com') ? origin : 'https://api.vedsaas.com';
      else if (/:(8010|8011|8012)\b/.test(origin)) window.API_BASE = origin;
      else window.API_BASE = 'http://127.0.0.1:8010';
    })();

    window.addEventListener('DOMContentLoaded', () => {
      const app = document.getElementById('app'); if (app) app.style.display = 'block';
      const ip = document.getElementById('landing-input');
      const btn = document.getElementById('landing-start');
      if (ip && btn) ip.addEventListener('keydown', e => { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); btn.click(); } });
      const mt = document.getElementById('menu-toggle');
      const bd = document.getElementById('backdrop');
      if (mt) mt.addEventListener('click', () => document.body.classList.toggle('sidebar-open'));
      if (bd) bd.addEventListener('click', () => document.body.classList.remove('sidebar-open'));
    });
  </script>

  <!-- Load helpers first, then app -->
  <script defer src="/vedsaas-fixes.js" referrerpolicy="no-referrer"></script>
  <script defer src="/app.js" referrerpolicy="no-referrer"></script>
</body>
</html>
