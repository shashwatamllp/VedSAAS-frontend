<!DOCTYPE html> 
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<meta name="ved-api-base" content="/api"/>
<title>VedSAAS</title>
<link rel="icon" href="/favicon.ico"/>
<link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" referrerpolicy="no-referrer"/>
<link rel="stylesheet" href="/public/css/vedsaas-ui.css"/>

<!-- CSP -->
<meta http-equiv="Content-Security-Policy" content="
  default-src 'self';
  img-src 'self' data:;
  style-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com;
  script-src 'self' 'unsafe-inline';
  font-src 'self' https://cdnjs.cloudflare.com;
  connect-src 'self' https://vedsaas.com https://*.vedsaas.com https://api.vedsaas.com http://127.0.0.1:8012 http://127.0.0.1:8000;
  frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests;
">
</head>
<body>

<div id="banner" class="banner"></div>

<div id="app" class="container" style="display:none;">
  <div class="sidebar">
    <div class="title">Chat History</div>
    <button class="new-topic-btn" id="new-topic">+ New Chat</button>
    <div class="history-list" id="history-list"></div>

    <div class="settings-summary">
      <div id="settings-header" class="user-chip" title="Account & Settings">
        <div id="settings-avatar" class="user-avatar">U</div>
        <div id="settings-username" class="user-name">User</div>
        <i id="settings-caret" class="fas fa-chevron-down"></i>
      </div>

      <div id="settings-panel" class="settings-panel">
        <button id="dark-toggle">üåô Toggle Dark Mode</button>
        <button id="lang-toggle">üåê Language</button>
        <button id="profile-open">üßë‚Äçüíº Profile</button>
        <button id="export-topic">üì• Export</button>
        <button id="delete-topic">üóë Delete This Chat</button>
        <button id="clear-all-chats">üßπ Clear All Chats</button>
        <button id="logout-btn">üö™ Logout</button>
      </div>
    </div>
  </div>

  <div class="main">
    <div class="rail">
      <div class="topbar">
        <h1 id="brand-title"></h1>
        <div class="top-controls">
          <div class="meta" id="meta-info">Welcome</div>
          <button class="btn" id="refresh-history" title="Reload history"><i class="fas fa-sync"></i></button>
          <button class="btn" id="top-delete-chat" title="Delete this chat"><i class="fas fa-trash"></i></button>
        </div>
      </div>

      <div class="content">
        <div id="landing" class="landing" style="display:none;">
          <div class="landing-card">
            <div class="title">Start a new conversation</div>
            <div class="hint">Ask anything. I‚Äôll reply in your language.</div>
            <div class="composer">
              <textarea id="landing-input" placeholder="Type your first message..." rows="1"></textarea>
              <button id="landing-start" class="send-btn" title="Send">
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
            <div class="landing-actions">
              <button id="landing-open-history" class="btn">Open Previous Chats</button>
            </div>
          </div>
        </div>

        <div id="chat-shell" style="display:none;flex:1;min-height:0;display:flex;flex-direction:column;">
          <div class="chat-area" id="chat-area"></div>
          <div class="composer-wrap">
            <div class="composer">
              <textarea id="main-input" placeholder="Type your message..." rows="1"></textarea>
              <button id="send-btn" class="send-btn" title="Send" disabled>
                <i class="fas fa-paper-plane"></i>
              </button>
            </div>
          </div>
        </div>
      </div> <!-- /content -->
    </div> <!-- /rail -->
  </div>
</div>

<div id="auth-overlay" class="overlay" style="display:none;">
  <div class="auth-box">
    <div id="login-screen">
      <h2>Login</h2>
      <input id="login-identifier" placeholder="Email or Mobile"/>
      <input id="login-password" type="password" placeholder="Password"/>
      <button id="login-submit">Login</button>
      <small>Tip: Same backend host/port as API_BASE.</small>
      <p style="color:#bbb;text-align:center;margin-top:8px;">Don't have account?
        <a id="open-register" href="#" style="color:#1e90ff;">Register</a></p>
    </div>

    <div id="register-screen" style="display:none;">
      <h2>Register</h2>
      <input id="reg-name" placeholder="Full name"/>
      <input id="reg-identifier" placeholder="Email or Mobile"/>
      <input id="reg-password" type="password" placeholder="Password"/>
      <div style="display:flex;gap:8px">
        <input id="reg-otp" placeholder="OTP (if received)" disabled style="flex:1"/>
        <button id="reg-send-otp" style="flex:0 0 120px">Send OTP</button>
      </div>
      <button id="reg-submit">Register</button>
      <p style="color:#bbb;text-align:center;margin-top:8px;">Already have account?
        <a id="open-login" href="#" style="color:#1e90ff;">Login</a></p>
    </div>

    <div id="verify-screen" style="display:none;">
      <h2>Verify OTP</h2>
      <input id="verify-identifier" placeholder="Email or Mobile"/>
      <input id="verify-otp" placeholder="Enter OTP"/>
      <button id="verify-submit">Verify</button>
      <button id="verify-resend" style="margin-top:8px;background:#444">Resend OTP</button>
    </div>
  </div>
</div>

<!-- Training consent popup -->
<div id="consent-overlay" class="overlay" style="display:none;">
  <div class="auth-box">
    <h2>Help improve VedSAAS</h2>
    <p style="margin:8px 0 10px;font-size:14px;color:#ddd;line-height:1.4;">
      We would like to use your conversations to train and improve VedSAAS.
    </p>
    <p style="font-size:12px;color:#bbb;margin-bottom:10px;line-height:1.4;">
      If you disagree, your chats will not be used for training. You can change this later in Preferences.
    </p>
    <button id="consent-yes">I agree</button>
    <button id="consent-no" style="margin-top:8px;background:#444;">I disagree</button>
  </div>
</div>

<div id="userpage" class="userpage">
  <div class="backdrop"></div>
  <div class="sheet">
    <aside class="aside">
      <div class="brand">
        <div id="up-avatar" class="avatar">U</div>
        <div>
          <div id="up-name" style="font-weight:700">User</div>
          <div id="plan-label" class="badge" style="margin-top:6px">
            <i class="fas fa-crown"></i><span style="margin-left:6px">Free</span>
          </div>
        </div>
      </div>
      <div class="nav" style="display:flex;flex-direction:column;height:100%;">
        <button data-tab="profile" class="active"><i class="fas fa-user"></i> Profile</button>
        <button data-tab="account"><i class="fas fa-id-badge"></i> Account</button>
        <button data-tab="preferences"><i class="fas fa-sliders-h"></i> Preferences</button>
        <button data-tab="usage"><i class="fas fa-chart-line"></i> Usage</button>
        <div style="flex:1"></div>
        <button id="userpage-logout" class="cta danger" style="width:100%;margin-top:8px">
          <i class="fas fa-right-from-bracket"></i> Logout
        </button>
        <button id="userpage-close" class="cta secondary" style="width:100%;margin-top:8px">
          <i class="fas fa-times"></i> Close
        </button>
      </div>
    </aside>
    <main class="main">
      <section data-panel="profile">
        <div class="section-title">Profile</div>
        <div class="kv"><label>Display name</label><input id="pf-name" class="ip" placeholder="Your name"/></div>
        <div class="kv"><label>Username (handle)</label><input id="pf-handle" class="ip" placeholder="@username"/></div>
        <div class="kv">
          <label>Avatar</label>
          <div class="row">
            <label class="badge" style="cursor:pointer">
              <i class="fas fa-upload"></i> Upload
              <input id="pf-avatar" type="file" accept="image/*" style="display:none">
            </label>
            <button id="pf-avatar-remove" class="cta secondary">Remove</button>
          </div>
          <div class="muted">Tip: If no avatar, initials are used.</div>
        </div>
        <div class="actions"><button id="pf-save" class="cta">
          <i class="fas fa-save"></i> Save</button>
        </div>
      </section>

      <section data-panel="account" style="display:none">
        <div class="section-title">Account</div>
        <div class="kv"><label>Email</label><input id="ac-email" class="ip" placeholder="email@example.com"/></div>
        <div class="kv"><label>Mobile</label><input id="ac-mobile" class="ip" placeholder="+91-XXXXXXXXXX"/></div>
        <div class="kv"><label>Plan</label>
          <div class="row">
            <span class="badge"><i class="fas fa-crown"></i>
              <span id="ac-plan-label" style="margin-left:6px">Free</span></span>
            <button id="ac-upgrade" class="cta">Upgrade</button>
          </div>
        </div>
        <div class="kv"><label>Sessions</label>
          <div class="card" id="ac-sessions" style="width:100%">
            <div class="muted">This device ‚Ä¢ Active now</div>
            <div class="muted">Chrome ‚Ä¢ Last used today</div>
          </div>
        </div>
      </section>

      <section data-panel="preferences" style="display:none">
        <div class="section-title">Preferences</div>
        <div class="kv"><label>Theme</label>
          <div class="row">
            <button id="pref-theme-dark" class="cta secondary">Dark</button>
            <button id="pref-theme-light" class="cta secondary">Light</button>
            <button id="pref-theme-system" class="cta secondary">System</button>
          </div>
        </div>
        <div class="kv"><label>Language</label>
          <select id="pref-lang" class="ip">
            <option value="auto">Auto (Detect)</option>
            <option value="en">English</option>
            <option value="hi">Hindi</option>
          </select>
        </div>
        <div class="kv"><label>Typing animation</label>
          <select id="pref-type-speed" class="ip">
            <option value="75">Slow (VedSAAS-like)</option>
            <option value="40">Normal</option>
            <option value="15">Fast</option>
            <option value="0">Instant</option>
          </select>
        </div>
        <div class="kv"><label>Training consent</label>
          <select id="pref-train-consent" class="ip">
            <option value="unset">Ask me every time</option>
            <option value="yes">Allow training</option>
            <option value="no">Don't use my chats</option>
          </select>
        </div>
        <div class="actions"><button id="pref-save" class="cta">
          <i class="fas fa-save"></i> Save</button>
        </div>
      </section>

      <section data-panel="usage" style="display:none">
        <div class="section-title">Usage</div>
        <div class="row">
          <div class="card" style="min-width:220px">
            <div class="muted">Conversations</div>
            <div id="usg-conv" style="font-size:22px;font-weight:700">0</div>
          </div>
          <div class="card" style="min-width:220px">
            <div class="muted">Messages</div>
            <div id="usg-msg" style="font-size:22px;font-weight:700">0</div>
          </div>
          <div class="card" style="min-width:220px">
            <div class="muted">Local storage</div>
            <div id="usg-local" style="font-size:22px;font-weight:700">0 KB</div>
          </div>
          <div class="card" style="min-width:220px">
            <div class="muted">Last active</div>
            <div id="usg-last" style="font-size:22px;font-weight:700">‚Äî</div>
          </div>
        </div>
      </section>
    </main>
  </div>
</div>

<button id="to-bottom" class="to-bottom">
  <i class="fas fa-angle-down"></i> Latest
</button>

<script src="/public/js/vedsaas-core.js" defer></script>
<script src="/public/js/vedsaas-account.js" defer></script>
</body>
</html>
